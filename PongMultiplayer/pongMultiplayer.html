<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Pong Multiplayer</title>
    <style>
        * { padding: 0; margin: 0; }
        canvas {
            background: rgba(255, 255, 255, 0); 
            display: block; 
            margin: auto; 
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
        }
        /* div {
            
            background-color: #8a995a;
            background-image: url("https://www.transparenttextures.com/patterns/white-diamond-dark.png ");
            
            https://www.transparenttextures.com/patterns/diagmonds.png
            https://www.transparenttextures.com/patterns/white-diamond-dark.png 
            https://www.svgbackgrounds.com/#rainbow-vortex
            
            


        }
         */
        body {
            
            background-color: #8a995a00;
            background-image: url("https://www.transparenttextures.com/patterns/white-diamond-dark.png");
            
            /*
            background-color: #ff7700;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1600 900'%3E%3Cpolygon fill='%23cc0000' points='957 450 539 900 1396 900'/%3E%3Cpolygon fill='%23aa0000' points='957 450 872.9 900 1396 900'/%3E%3Cpolygon fill='%23d6002b' points='-60 900 398 662 816 900'/%3E%3Cpolygon fill='%23b10022' points='337 900 398 662 816 900'/%3E%3Cpolygon fill='%23d9004b' points='1203 546 1552 900 876 900'/%3E%3Cpolygon fill='%23b2003d' points='1203 546 1552 900 1162 900'/%3E%3Cpolygon fill='%23d3006c' points='641 695 886 900 367 900'/%3E%3Cpolygon fill='%23ac0057' points='587 900 641 695 886 900'/%3E%3Cpolygon fill='%23c4008c' points='1710 900 1401 632 1096 900'/%3E%3Cpolygon fill='%239e0071' points='1710 900 1401 632 1365 900'/%3E%3Cpolygon fill='%23aa00aa' points='1210 900 971 687 725 900'/%3E%3Cpolygon fill='%23880088' points='943 900 1210 900 971 687'/%3E%3C/svg%3E");
            background-attachment: fixed;
            background-size: cover;
            
            
            background-color: #ff9d00;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100%25' height='100%25' viewBox='0 0 1600 800'%3E%3Cg stroke='%23000' stroke-width='66.7' stroke-opacity='0.05' %3E%3Ccircle fill='%23ff9d00' cx='0' cy='0' r='1800'/%3E%3Ccircle fill='%23fb8d17' cx='0' cy='0' r='1700'/%3E%3Ccircle fill='%23f47d24' cx='0' cy='0' r='1600'/%3E%3Ccircle fill='%23ed6e2d' cx='0' cy='0' r='1500'/%3E%3Ccircle fill='%23e35f34' cx='0' cy='0' r='1400'/%3E%3Ccircle fill='%23d85239' cx='0' cy='0' r='1300'/%3E%3Ccircle fill='%23cc453e' cx='0' cy='0' r='1200'/%3E%3Ccircle fill='%23be3941' cx='0' cy='0' r='1100'/%3E%3Ccircle fill='%23b02f43' cx='0' cy='0' r='1000'/%3E%3Ccircle fill='%23a02644' cx='0' cy='0' r='900'/%3E%3Ccircle fill='%23901e44' cx='0' cy='0' r='800'/%3E%3Ccircle fill='%23801843' cx='0' cy='0' r='700'/%3E%3Ccircle fill='%236f1341' cx='0' cy='0' r='600'/%3E%3Ccircle fill='%235e0f3d' cx='0' cy='0' r='500'/%3E%3Ccircle fill='%234e0c38' cx='0' cy='0' r='400'/%3E%3Ccircle fill='%233e0933' cx='0' cy='0' r='300'/%3E%3Ccircle fill='%232e062c' cx='0' cy='0' r='200'/%3E%3Ccircle fill='%23210024' cx='0' cy='0' r='100'/%3E%3C/g%3E%3C/svg%3E");
            background-attachment: fixed;
            background-size: cover;
            */
        }

        .animated-shape {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' version='1.1' xmlns:xlink='http://www.w3.org/1999/xlink' xmlns:svgjs='http://svgjs.com/svgjs' width='1000' height='1000' preserveAspectRatio='none' viewBox='0 0 1000 1000'%3e%3cg mask='url(%26quot%3b%23SvgjsMask1153%26quot%3b)' fill='none'%3e%3crect width='1000' height='1000' x='0' y='0' fill='rgba(90%2c 139%2c 183%2c 0.53)'%3e%3c/rect%3e%3cpath d='M106.38129125260934 377.3581876760393L370.98209219664136 410.10308280159813 283.67360599559254 194.00699641370431z' fill='rgba(99%2c 139%2c 183%2c 0.4)' class='triangle-float2'%3e%3c/path%3e%3cpath d='M712.16%2c900.964C740.814%2c900.72%2c763.724%2c879.745%2c777.699%2c854.729C791.282%2c830.414%2c796.29%2c800.457%2c781.488%2c776.864C767.389%2c754.392%2c738.689%2c750.284%2c712.16%2c750.267C685.591%2c750.25%2c656.986%2c754.387%2c642.676%2c776.773C627.453%2c800.587%2c630.861%2c831.195%2c644.661%2c855.861C658.822%2c881.172%2c683.158%2c901.211%2c712.16%2c900.964' fill='rgba(99%2c 139%2c 183%2c 0.4)' class='triangle-float3'%3e%3c/path%3e%3cpath d='M311.1144904041066 886.0532628740066L336.99783004991235 639.7897361913813 90.73430336728708 613.9063965455756 64.85096372148135 860.1699232282009z' fill='rgba(99%2c 139%2c 183%2c 0.4)' class='triangle-float2'%3e%3c/path%3e%3cpath d='M220.95804017491633 724.0667489475509L330.16173644174404 921.5189844807392 434.6849887642064 754.2468147014324z' fill='rgba(99%2c 139%2c 183%2c 0.4)' class='triangle-float3'%3e%3c/path%3e%3c/g%3e%3cdefs%3e%3cmask id='SvgjsMask1153'%3e%3crect width='1000' height='1000' fill='white'%3e%3c/rect%3e%3c/mask%3e%3cstyle%3e %40keyframes float1 %7b 0%25%7btransform: translate(0%2c 0)%7d 50%25%7btransform: translate(-10px%2c 0)%7d 100%25%7btransform: translate(0%2c 0)%7d %7d .triangle-float1 %7b animation: float1 5s infinite%3b %7d %40keyframes float2 %7b 0%25%7btransform: translate(0%2c 0)%7d 50%25%7btransform: translate(-5px%2c -5px)%7d 100%25%7btransform: translate(0%2c 0)%7d %7d .triangle-float2 %7b animation: float2 4s infinite%3b %7d %40keyframes float3 %7b 0%25%7btransform: translate(0%2c 0)%7d 50%25%7btransform: translate(0%2c -10px)%7d 100%25%7btransform: translate(0%2c 0)%7d %7d .triangle-float3 %7b animation: float3 6s infinite%3b %7d %3c/style%3e%3c/defs%3e%3c/svg%3e");        
        }

        .meteor {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' version='1.1' xmlns:xlink='http://www.w3.org/1999/xlink' xmlns:svgjs='http://svgjs.com/svgjs' width='1440' height='1000' preserveAspectRatio='none' viewBox='0 0 1440 1000'%3e%3cg mask='url(%26quot%3b%23SvgjsMask1048%26quot%3b)' fill='none'%3e%3crect width='1440' height='1000' x='0' y='0' fill='rgba(90%2c 139%2c 183%2c 0.53)'%3e%3c/rect%3e%3cpath d='M53 276L52 -25' stroke-width='8' stroke='url(%23SvgjsLinearGradient1049)' stroke-linecap='round' class='Down'%3e%3c/path%3e%3cpath d='M1282 126L1281 -614' stroke-width='6' stroke='url(%23SvgjsLinearGradient1049)' stroke-linecap='round' class='Down'%3e%3c/path%3e%3cpath d='M411 407L410 893' stroke-width='10' stroke='url(%23SvgjsLinearGradient1050)' stroke-linecap='round' class='Up'%3e%3c/path%3e%3cpath d='M502 246L501 -112' stroke-width='6' stroke='url(%23SvgjsLinearGradient1049)' stroke-linecap='round' class='Down'%3e%3c/path%3e%3cpath d='M1092 731L1091 186' stroke-width='6' stroke='url(%23SvgjsLinearGradient1049)' stroke-linecap='round' class='Down'%3e%3c/path%3e%3cpath d='M959 172L958 -242' stroke-width='8' stroke='url(%23SvgjsLinearGradient1050)' stroke-linecap='round' class='Up'%3e%3c/path%3e%3cpath d='M639 512L638 72' stroke-width='10' stroke='url(%23SvgjsLinearGradient1050)' stroke-linecap='round' class='Up'%3e%3c/path%3e%3cpath d='M1433 142L1432 816' stroke-width='8' stroke='url(%23SvgjsLinearGradient1049)' stroke-linecap='round' class='Down'%3e%3c/path%3e%3cpath d='M948 909L947 1329' stroke-width='6' stroke='url(%23SvgjsLinearGradient1050)' stroke-linecap='round' class='Up'%3e%3c/path%3e%3cpath d='M113 883L112 212' stroke-width='10' stroke='url(%23SvgjsLinearGradient1049)' stroke-linecap='round' class='Down'%3e%3c/path%3e%3cpath d='M98 436L97 850' stroke-width='6' stroke='url(%23SvgjsLinearGradient1049)' stroke-linecap='round' class='Down'%3e%3c/path%3e%3cpath d='M35 166L34 568' stroke-width='6' stroke='url(%23SvgjsLinearGradient1049)' stroke-linecap='round' class='Down'%3e%3c/path%3e%3cpath d='M717 524L716 953' stroke-width='10' stroke='url(%23SvgjsLinearGradient1049)' stroke-linecap='round' class='Down'%3e%3c/path%3e%3cpath d='M558 703L557 233' stroke-width='6' stroke='url(%23SvgjsLinearGradient1050)' stroke-linecap='round' class='Up'%3e%3c/path%3e%3cpath d='M297 930L296 249' stroke-width='10' stroke='url(%23SvgjsLinearGradient1049)' stroke-linecap='round' class='Down'%3e%3c/path%3e%3cpath d='M1190 112L1189 -441' stroke-width='10' stroke='url(%23SvgjsLinearGradient1049)' stroke-linecap='round' class='Down'%3e%3c/path%3e%3cpath d='M507 908L506 343' stroke-width='6' stroke='url(%23SvgjsLinearGradient1050)' stroke-linecap='round' class='Up'%3e%3c/path%3e%3cpath d='M648 37L647 715' stroke-width='6' stroke='url(%23SvgjsLinearGradient1049)' stroke-linecap='round' class='Down'%3e%3c/path%3e%3cpath d='M1238 303L1237 901' stroke-width='10' stroke='url(%23SvgjsLinearGradient1050)' stroke-linecap='round' class='Up'%3e%3c/path%3e%3cpath d='M101 195L100 680' stroke-width='6' stroke='url(%23SvgjsLinearGradient1050)' stroke-linecap='round' class='Up'%3e%3c/path%3e%3cpath d='M1389 769L1388 404' stroke-width='6' stroke='url(%23SvgjsLinearGradient1050)' stroke-linecap='round' class='Up'%3e%3c/path%3e%3cpath d='M1416 584L1415 1310' stroke-width='10' stroke='url(%23SvgjsLinearGradient1050)' stroke-linecap='round' class='Up'%3e%3c/path%3e%3cpath d='M447 598L446 867' stroke-width='8' stroke='url(%23SvgjsLinearGradient1049)' stroke-linecap='round' class='Down'%3e%3c/path%3e%3cpath d='M723 386L722 914' stroke-width='8' stroke='url(%23SvgjsLinearGradient1050)' stroke-linecap='round' class='Up'%3e%3c/path%3e%3cpath d='M1409 580L1408 1279' stroke-width='10' stroke='url(%23SvgjsLinearGradient1049)' stroke-linecap='round' class='Down'%3e%3c/path%3e%3cpath d='M1375 357L1374 -45' stroke-width='8' stroke='url(%23SvgjsLinearGradient1049)' stroke-linecap='round' class='Down'%3e%3c/path%3e%3cpath d='M1314 958L1313 517' stroke-width='10' stroke='url(%23SvgjsLinearGradient1050)' stroke-linecap='round' class='Up'%3e%3c/path%3e%3cpath d='M789 353L788 650' stroke-width='6' stroke='url(%23SvgjsLinearGradient1049)' stroke-linecap='round' class='Down'%3e%3c/path%3e%3cpath d='M510 237L509 -469' stroke-width='6' stroke='url(%23SvgjsLinearGradient1049)' stroke-linecap='round' class='Down'%3e%3c/path%3e%3cpath d='M1136 929L1135 1566' stroke-width='6' stroke='url(%23SvgjsLinearGradient1049)' stroke-linecap='round' class='Down'%3e%3c/path%3e%3cpath d='M101 226L100 880' stroke-width='6' stroke='url(%23SvgjsLinearGradient1049)' stroke-linecap='round' class='Down'%3e%3c/path%3e%3cpath d='M984 572L983 890' stroke-width='8' stroke='url(%23SvgjsLinearGradient1049)' stroke-linecap='round' class='Down'%3e%3c/path%3e%3cpath d='M745 811L744 176' stroke-width='8' stroke='url(%23SvgjsLinearGradient1050)' stroke-linecap='round' class='Up'%3e%3c/path%3e%3cpath d='M1415 587L1414 844' stroke-width='6' stroke='url(%23SvgjsLinearGradient1050)' stroke-linecap='round' class='Up'%3e%3c/path%3e%3cpath d='M736 955L735 295' stroke-width='6' stroke='url(%23SvgjsLinearGradient1050)' stroke-linecap='round' class='Up'%3e%3c/path%3e%3cpath d='M1428 11L1427 422' stroke-width='6' stroke='url(%23SvgjsLinearGradient1049)' stroke-linecap='round' class='Down'%3e%3c/path%3e%3c/g%3e%3cdefs%3e%3cmask id='SvgjsMask1048'%3e%3crect width='1440' height='1000' fill='white'%3e%3c/rect%3e%3c/mask%3e%3clinearGradient x1='0%25' y1='0%25' x2='0%25' y2='100%25' id='SvgjsLinearGradient1049'%3e%3cstop stop-color='rgba(99%2c 139%2c 183%2c 0)' offset='0'%3e%3c/stop%3e%3cstop stop-color='rgba(99%2c 139%2c 183%2c 0.4)' offset='1'%3e%3c/stop%3e%3c/linearGradient%3e%3clinearGradient x1='0%25' y1='100%25' x2='0%25' y2='0%25' id='SvgjsLinearGradient1050'%3e%3cstop stop-color='rgba(99%2c 139%2c 183%2c 0)' offset='0'%3e%3c/stop%3e%3cstop stop-color='rgba(99%2c 139%2c 183%2c 0.4)' offset='1'%3e%3c/stop%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e");

        }

        .circles {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' version='1.1' xmlns:xlink='http://www.w3.org/1999/xlink' xmlns:svgjs='http://svgjs.com/svgjs' width='2000' height='2000' preserveAspectRatio='none' viewBox='0 0 2000 2000'%3e%3cg clip-path='url(%26quot%3b%23SvgjsClipPath1050%26quot%3b)' fill='none'%3e%3crect width='2000' height='2000' x='0' y='0' fill='rgba(90%2c 139%2c 183%2c 0.53)'%3e%3c/rect%3e%3ccircle r='333.335' cx='115.9' cy='203.29' stroke='%23638bb7' stroke-opacity='0.4' stroke-width='2'%3e%3c/circle%3e%3ccircle r='238.605' cx='1176.61' cy='846.33' stroke='%23638bb7' stroke-opacity='0.4' stroke-width='2'%3e%3c/circle%3e%3ccircle r='511.95' cx='1151.59' cy='9.19' stroke='%23638bb7' stroke-opacity='0.4' stroke-width='2'%3e%3c/circle%3e%3ccircle r='471.655' cx='551.23' cy='1245.22' stroke='%23638bb7' stroke-opacity='0.4' stroke-width='2'%3e%3c/circle%3e%3ccircle r='494.36' cx='1427.09' cy='1588.6' stroke='%23638bb7' stroke-opacity='0.4' stroke-width='2'%3e%3c/circle%3e%3ccircle r='600.21' cx='1142.28' cy='474.46' stroke='%23638bb7' stroke-opacity='0.4' stroke-width='2'%3e%3c/circle%3e%3ccircle r='579.38' cx='593.9' cy='1862.75' stroke='%23638bb7' stroke-opacity='0.4' stroke-width='2'%3e%3c/circle%3e%3ccircle r='316.72' cx='93.63' cy='1896.7' stroke='%23638bb7' stroke-opacity='0.4' stroke-width='2'%3e%3c/circle%3e%3ccircle r='353.52' cx='564.18' cy='1668.16' stroke='%23638bb7' stroke-opacity='0.4' stroke-width='2'%3e%3c/circle%3e%3ccircle r='601.69' cx='14.55' cy='246.97' stroke='%23638bb7' stroke-opacity='0.4' stroke-width='2'%3e%3c/circle%3e%3ccircle r='452.85' cx='647.52' cy='455.92' stroke='%23638bb7' stroke-opacity='0.4' stroke-width='2'%3e%3c/circle%3e%3ccircle r='372.84' cx='982.7' cy='436.49' stroke='%23638bb7' stroke-opacity='0.4' stroke-width='2'%3e%3c/circle%3e%3ccircle r='497.205' cx='21.7' cy='537.29' stroke='%23638bb7' stroke-opacity='0.4' stroke-width='2'%3e%3c/circle%3e%3ccircle r='644.695' cx='406.48' cy='1669.53' stroke='%23638bb7' stroke-opacity='0.4' stroke-width='2'%3e%3c/circle%3e%3ccircle r='580.55' cx='1861.34' cy='238.43' stroke='%23638bb7' stroke-opacity='0.4' stroke-width='2'%3e%3c/circle%3e%3ccircle r='252.78' cx='663.37' cy='1991.88' stroke='%23638bb7' stroke-opacity='0.4' stroke-width='2'%3e%3c/circle%3e%3ccircle r='205.31' cx='1750.53' cy='1385.23' stroke='%23638bb7' stroke-opacity='0.4' stroke-width='2'%3e%3c/circle%3e%3ccircle r='606.655' cx='385.78' cy='1584.38' stroke='%23638bb7' stroke-opacity='0.4' stroke-width='2'%3e%3c/circle%3e%3ccircle r='310.8' cx='1345.74' cy='544.09' stroke='%23638bb7' stroke-opacity='0.4' stroke-width='2'%3e%3c/circle%3e%3ccircle r='320.225' cx='1974.59' cy='509.18' stroke='%23638bb7' stroke-opacity='0.4' stroke-width='2'%3e%3c/circle%3e%3ccircle r='412.465' cx='429.76' cy='632.12' stroke='%23638bb7' stroke-opacity='0.4' stroke-width='2'%3e%3c/circle%3e%3ccircle r='210.315' cx='987.67' cy='483.27' stroke='%23638bb7' stroke-opacity='0.4' stroke-width='2'%3e%3c/circle%3e%3ccircle r='210.585' cx='885.91' cy='1358.92' stroke='%23638bb7' stroke-opacity='0.4' stroke-width='2'%3e%3c/circle%3e%3ccircle r='568.38' cx='1550.82' cy='2.47' stroke='%23638bb7' stroke-opacity='0.4' stroke-width='2'%3e%3c/circle%3e%3ccircle r='188.325' cx='797.77' cy='357.07' stroke='%23638bb7' stroke-opacity='0.4' stroke-width='2'%3e%3c/circle%3e%3c/g%3e%3cdefs%3e%3cclipPath id='SvgjsClipPath1050'%3e%3crect width='2000' height='2000' x='0' y='0'%3e%3c/rect%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e");
        }

        .waves {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' version='1.1' xmlns:xlink='http://www.w3.org/1999/xlink' xmlns:svgjs='http://svgjs.com/svgjs' width='2000' height='1250' preserveAspectRatio='none' viewBox='0 0 2000 1250'%3e%3cg mask='url(%26quot%3b%23SvgjsMask1162%26quot%3b)' fill='none'%3e%3cpath d='M 0%2c322 C 100%2c289.4 300%2c120.2 500%2c159 C 700%2c197.8 800%2c515.8 1000%2c516 C 1200%2c516.2 1300%2c138.6 1500%2c160 C 1700%2c181.4 1900%2c530.4 2000%2c623L2000 1250L0 1250z' fill='rgba(90%2c 139%2c 183%2c 0.53)'%3e%3c/path%3e%3cpath d='M 0%2c916 C 100%2c923.6 300%2c985.2 500%2c954 C 700%2c922.8 800%2c730.2 1000%2c760 C 1200%2c789.8 1300%2c1121.2 1500%2c1103 C 1700%2c1084.8 1900%2c755.8 2000%2c669L2000 1250L0 1250z' fill='rgba(99%2c 139%2c 183%2c 0.4)'%3e%3c/path%3e%3c/g%3e%3cdefs%3e%3cmask id='SvgjsMask1162'%3e%3crect width='2000' height='1250' fill='white'%3e%3c/rect%3e%3c/mask%3e%3c/defs%3e%3c/svg%3e");
        }

        .lines {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' version='1.1' xmlns:xlink='http://www.w3.org/1999/xlink' xmlns:svgjs='http://svgjs.com/svgjs' width='2000' height='1500' preserveAspectRatio='none' viewBox='0 0 2000 1500'%3e%3cg mask='url(%26quot%3b%23SvgjsMask1017%26quot%3b)' fill='none'%3e%3crect width='2000' height='1500' x='0' y='0' fill='rgba(90%2c 139%2c 183%2c 0.53)'%3e%3c/rect%3e%3cpath d='M675 0C712.57 0.51 712.53 5.14 750 5.14C776.82 5.14 776.68 0.37 803.57 0C964.18 -2.2 964.28 0 1125 0C1312.5 0 1312.5 0 1500 0C1640.03 0 1708.19 -79.61 1780.06 0C1877.46 107.89 1797.37 192.77 1838.54 375C1844.84 402.9 1851.84 420.26 1875 420.26C1915.33 420.26 1955.43 419.66 1965.52 375C2002.9 209.53 1888.51 107.34 1969.94 0C2030.75 -80.16 2190.13 -80.16 2250 0C2330.16 107.34 2250 187.5 2250 375C2250 562.5 2250 562.5 2250 750C2250 937.5 2250 937.5 2250 1125C2250 1271.64 2316.65 1320.26 2250 1418.27C2189.15 1507.76 2124.48 1471.78 1995 1500C1936.98 1512.65 1935 1500 1875 1500C1687.5 1500 1687.5 1500 1500 1500C1312.5 1500 1312.5 1500 1125 1500C937.5 1500 937.5 1500 750 1500C562.5 1500 562.5 1500 375 1500C187.5 1500 93.75 1593.75 0 1500C-93.75 1406.25 -92.49 1195.72 0 1125C95.01 1052.34 199.48 1213.24 375 1213.24C433.27 1213.24 462.01 1183.54 467.59 1125C484.07 951.92 460.28 924.12 419.12 750C413.99 728.28 396.11 733.33 375 733.33C361.55 733.33 360.38 739.16 350 750C172.88 935 101.09 1125 0 1125C-73.91 1125 0 937.5 0 750C0 562.5 0 562.5 0 375C0 187.5 -93.75 93.75 0 0C93.75 -93.75 187.5 0 375 0C525 0 525.07 -2.06 675 0' stroke='rgba(99%2c 139%2c 183%2c 0.4)' stroke-width='2'%3e%3c/path%3e%3cpath d='M1500 668.67C1433.14 668.67 1359.38 710.04 1359.38 750C1359.38 789.5 1432.92 827.59 1500 827.59C1552.15 827.59 1597.83 789.36 1597.83 750C1597.83 709.9 1552.36 668.67 1500 668.67' stroke='rgba(99%2c 139%2c 183%2c 0.4)' stroke-width='2'%3e%3c/path%3e%3cpath d='M192.57 375C192.57 291.7 264.21 249.9 375 201.92C542.93 129.18 561.19 157.22 750 133.56C936.19 110.23 950.38 153.73 1125 107.95C1205.1 86.95 1181.15 22.53 1259.43 0C1368.65 -31.44 1379.72 0 1500 0C1580.7 0 1630.22 -56.11 1661.39 0C1734.38 131.39 1754.98 214.36 1708.33 375C1674.29 492.22 1613.05 477.83 1500 555.72C1340.92 665.33 1164.06 654.55 1164.06 750C1164.06 844.36 1339.76 935.34 1500 935.34C1624.58 935.34 1625.71 851.78 1733.7 750C1813.21 675.06 1783.37 635.97 1875 581.9C2041.52 483.63 2143.67 397.65 2250 445.31C2331.17 481.7 2250 597.65 2250 750C2250 937.5 2250 937.5 2250 1125C2250 1211.54 2307.85 1256.09 2250 1298.08C2120.35 1392.18 2054.15 1328.99 1875 1397.18C1788.9 1429.95 1805.62 1476.39 1719.51 1500C1618.12 1527.8 1609.76 1500 1500 1500C1312.5 1500 1312.5 1500 1125 1500C937.5 1500 937.5 1500 750 1500C562.5 1500 562.5 1500 375 1500C196.43 1500 17.86 1541.71 17.86 1500C17.86 1453.48 210.85 1432.39 375 1323.53C493.58 1244.89 497.04 1238.22 583.33 1125C684.54 992.22 632.9 936.91 750 831.52C841.23 749.41 1000 787.14 1000 750C1000 713.49 871.32 727.88 750 684.21C558.82 615.38 551.43 622.87 375 525C272.72 468.26 192.57 453.24 192.57 375' stroke='rgba(99%2c 139%2c 183%2c 0.4)' stroke-width='2'%3e%3c/path%3e%3cpath d='M2250 344.59C2207.65 344.59 2088.61 120.98 2088.61 0C2088.61 -51.31 2224.26 -54.96 2250 0C2304.96 117.34 2288.35 344.59 2250 344.59' stroke='rgba(99%2c 139%2c 183%2c 0.4)' stroke-width='2'%3e%3c/path%3e%3cpath d='M0 698.86C10.38 698.86 37.5 725.54 37.5 750C37.5 771.2 10.83 790.18 0 790.18C-7.92 790.18 0 770.09 0 750C0 724.43 -8.37 698.86 0 698.86' stroke='rgba(99%2c 139%2c 183%2c 0.4)' stroke-width='2'%3e%3c/path%3e%3cpath d='M465.52 375C465.52 311.91 601.85 290.07 750 261.99C931.59 227.57 958.76 313.46 1125 250C1301.92 182.47 1274.61 107.81 1436.32 0C1462.11 -17.19 1468.16 0 1500 0C1521.36 0 1538.74 -19.1 1542.72 0C1577.81 168.4 1594.89 201.31 1578.13 375C1573.53 422.69 1546.88 422.45 1500 442.77C1320.31 520.66 1316.83 551.74 1125 571.43C941.83 590.23 928.9 573.03 750 519.74C599.16 474.81 465.52 440.79 465.52 375' stroke='rgba(99%2c 139%2c 183%2c 0.4)' stroke-width='2'%3e%3c/path%3e%3cpath d='M2250 91.22C2238.79 91.22 2207.28 32.03 2207.28 0C2207.28 -13.58 2243.19 -14.55 2250 0C2264.55 31.06 2260.15 91.22 2250 91.22' stroke='rgba(99%2c 139%2c 183%2c 0.4)' stroke-width='2'%3e%3c/path%3e%3cpath d='M1869.57 750C1872.87 747.36 1871.19 743.53 1875 743.53C1888.33 743.53 1890.87 743.01 1903.85 750C2078.37 844.07 2130.73 816.43 2250 945.65C2303.8 1003.93 2250 1035.32 2250 1125C2250 1151.44 2272.85 1170.51 2250 1177.88C2085.35 1231 2048.49 1175.8 1875 1245.97C1673.49 1327.48 1694.94 1462.48 1500 1481.25C1319.94 1498.59 1319.59 1374.94 1125 1318.18C944.59 1265.56 903.57 1332.15 750 1262.5C690.6 1235.56 699.07 1191.69 699.07 1125C699.07 1078.1 704.91 1053.57 750 1035.33C917.88 967.42 937.93 950.76 1125 952.7C1312.93 954.65 1332.52 1088.7 1500 1043.1C1704.8 987.35 1685.37 897.15 1869.57 750' stroke='rgba(99%2c 139%2c 183%2c 0.4)' stroke-width='2'%3e%3c/path%3e%3cpath d='M241.07 1500C241.07 1482.55 306.74 1433.82 375 1433.82C456.42 1433.82 540.44 1482.84 540.44 1500C540.44 1515.93 457.72 1500 375 1500C308.03 1500 241.07 1515.64 241.07 1500' stroke='rgba(99%2c 139%2c 183%2c 0.4)' stroke-width='2'%3e%3c/path%3e%3c/g%3e%3cdefs%3e%3cmask id='SvgjsMask1017'%3e%3crect width='2000' height='1500' fill='white'%3e%3c/rect%3e%3c/mask%3e%3c/defs%3e%3c/svg%3e");
        }

        

       
    </style>
    <link rel="icon" href="extras/icon.png">
    <link rel="shortcut icon" type="image/x-icon" href="extras/icon2.ico" />
    <link rel="shortcut icon" type="image/png" href="extras/icon.png" />
</head>
<body onload="setBackground()">
    
    <div style = "text-align:center;">
        <canvas id="myCanvas" ></canvas>
        <!-- <p>Bottom paddle: arrow keys. Top paddle: A/D. Left paddle: O/L</p>
        <p>Right paddle: -/+.</p>
        Toggle resize: <button onclick="toggleRandomResize()">Resize</button> or spacebar.
        Toggle realtive rebounds: <input type="checkbox" id="myCheckRelative" onclick="checkRealtiveRebounds()" checked="true">
        <p >Ball Pos (x,y): <span id="ballX"></span> <span id="ballY"></span></p>
        <p>Ball velocity (dx,dy): <span id="ballDx"></span> , <span id="ballDy"></span></p>
        <p >Status: <span id="status"></span></p>
        <button onclick="startGame()">Start Game</button> -->
        
    </div>

    <audio controls autoplay hidden>
        <source src="Retro_Arcade.mp3" type="audio/mpeg">
      Your browser does not support the audio element.
      <https://patrickdearteaga.com/arcade-music/>
      <https://www.dl-sounds.com/royalty-free/category/game-film/video-game/?_sfm_bpm=0+220/>
    </audio>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        // Scripts for socket.io
        var socketType = 'game';
        var url = window.location.host;
        var socket = io(url , {
          query: {
            "data" : socketType
          }
        });

        var controllers = [];

        socket.on('controller connection', (id) =>{
            var full;
            var orient;
            if (controllers.length <= 4) {
                if (controllers.length === 1 || controllers.length === 3) orient = 'vertical';
                else orient = 'horizontal';
                full = false;
                controllers.push(id);
            }
            else full = true;
            callback = {
                socket: id,
                isfull: full,
                orientation: orient
            };
            socket.emit('connection callback', callback);
        });

        socket.on('leftOn', (id) =>{
            // Get the controller
            var index = controllers.indexOf(id);
            // Trigger the corresponding controller
            if (index === 0) bottomPaddle.leftPress = true;
            if (index === 2) topPaddle.leftPress = true;
            // Wrong oriented controller triggering
            else console.log("Input from invalid paddle: leftOn");
        });

        socket.on('leftOff', (id) =>{
            // Get the controller
            var index = controllers.indexOf(id);
            // Trigger the corresponding controller
            if (index === 0) bottomPaddle.leftPress = false;
            if (index === 2) topPaddle.leftPress = false;
            // Wrong oriented controller triggering
            else console.log("Input from invalid paddle: leftOff");
        });

        socket.on('rightOn', (id) =>{
            // Get the controller
            var index = controllers.indexOf(id);
            // Trigger the corresponding controller
            if (index === 0) bottomPaddle.rightPress = true;
            if (index === 2) topPaddle.rightPress = true;
            // Wrong oriented controller triggering
            else console.log("Input from invalid paddle: rightOn");
        });

        socket.on('rightOff', (id) =>{
            // Get the controller
            var index = controllers.indexOf(id);
            // Trigger the corresponding controller
            if (index === 0) bottomPaddle.rightPress = false;
            if (index === 2) topPaddle.rightPress = false;
            // Wrong oriented controller triggering
            else console.log("Input from invalid paddle: rightOff");
        });

        socket.on('upOn', (id) =>{
            // Get the controller
            var index = controllers.indexOf(id);
            // Trigger the corresponding controller
            if (index === 1) leftPaddle.upPress = true;
            if (index === 3) rightPaddle.upPress = true;
            // Wrong oriented controller triggering
            else console.log("Input from invalid paddle: upOn");
        });

        socket.on('upOff', (id) =>{
            // Get the controller
            var index = controllers.indexOf(id);
            // Trigger the corresponding controller
            if (index === 1) leftPaddle.upPress = false;
            if (index === 3) rightPaddle.upPress = false;
            // Wrong oriented controller triggering
            else console.log("Input from invalid paddle: upOff");
        });

        socket.on('downOn', (id) =>{
            // Get the controller
            var index = controllers.indexOf(id);
            // Trigger the corresponding controller
            if (index === 1) leftPaddle.downPress = true;
            if (index === 3) rightPaddle.downPress = true;
            // Wrong oriented controller triggering
            else console.log("Input from invalid paddle: downOn");
        });

        socket.on('downOff', (id) =>{
            // Get the controller
            var index = controllers.indexOf(id);
            // Trigger the corresponding controller
            if (index === 1) leftPaddle.downPress = false;
            if (index === 3) rightPaddle.downPress = false;
            // Wrong oriented controller triggering
            else console.log("Input from invalid paddle: downOff");
        });

    </script>

    <script>
        var canvas = document.getElementById("myCanvas");
        var ctx = canvas.getContext("2d");
        ctx.canvas.height = Math.round(Math.round((window.innerHeight*2/3))/10)*10;
        ctx.canvas.width = Math.round(Math.round((window.innerHeight*2/3))/10)*10;
        var gameStarted = false;
        var gameOver = false;

        //Global ball attributes
        var ballSpeed = 2;  
        var defaultBallSpeed = ballSpeed;
        var ballRadius = 10;
        var paddleSpeed = 10;   //Note: paddle speed can only be 2, 5 or 10
        var speedRatio = Math.sqrt((ballSpeed*ballSpeed) + (ballSpeed*ballSpeed));
        var rand;
        var randAngleToggle = false;
        var relativeAngleReboundToggle = true;
        var randResizeToggle = false;
        var resizeAmount = 200;
        var resizeTick = resizeAmount;
        var resizePerTick = 1;
        var canvasSizeIncrease = false;
        var paddleHeight = 10;
        var paddleWidth = 70;   
        var defaultPaddleWidth = 70; //Note: must be multiple of 10
        var borderWidth = Math.round(Math.round(0.1 * canvas.width)/10)*10; //Round to whole number and round to nearest 10

        // Colours
        // https://www.reddit.com/r/coolguides/comments/njqt0x/color_combinations_that_go_well_with_each_other/

        // Sounds
        // https://www.zapsplat.com/sound-effect-category/game-sounds/page/12/

        // Balls
        var ball1 = {
            x: canvas.width*4/5,
            y: canvas.height/2,
            dx: -ballSpeed,
            dy: ballSpeed,
            colour: "#000000",
            owner: 'none',
            initialPos: true
        };

        var ball2 = {
            x: canvas.width*4/5,
            y: canvas.height/2,
            dx: -ballSpeed,
            dy: ballSpeed,
            colour: "#000000",
            owner: 'none',
            initialPos: false
        };

        //Powerups
        var powerup1 = {
            x: 10,
            y: 10,
            size: borderWidth/2,
            active: false,
            colourCounter: 10,
            colour: "#000000"
        };

        var powerup2 = {
            x: 10,
            y: 10,
            size: borderWidth/2,
            active: false,
            colourCounter: 10,
            colour: "#000000"
        };

        // Paddles
        var topPaddle = {
            x: Math.round(Math.round(((canvas.width/2)-(defaultPaddleWidth/2)))/10)*10,
            y: (canvas.height-defaultPaddleWidth)/2,
            width: defaultPaddleWidth,
            leftPress: false,
            rightPress: false,
            lives: 2,
            colour: "#FC1212"
        }

        var leftPaddle = {
            x: (canvas.width-defaultPaddleWidth)/2,
            y: Math.round(Math.round(((canvas.height-defaultPaddleWidth)/2))/10)*10,
            width: defaultPaddleWidth,
            upPress: false,
            downPress: false,
            lives: 2,
            colour: "#3CC01B"
        }

        var rightPaddle = {
            x: (canvas.width-defaultPaddleWidth)/2,
            y: Math.round(Math.round(((canvas.height-defaultPaddleWidth)/2))/10)*10,
            width: defaultPaddleWidth,
            upPress: false,
            downPress: false,
            lives: 2,
            colour: "#C072CC"
        }
        
        var bottomPaddle = {
            x: Math.round(Math.round(((canvas.width/2)-(defaultPaddleWidth/2)))/10)*10,
            y: ((canvas.height-defaultPaddleWidth)/2),
            width: defaultPaddleWidth,
            leftPress: false,
            rightPress: false,
            lives: 2,
            colour: "#0095DD"
        }
        

        //////////////////////////////////////////////////////// FUNCTIONS ///////////////////////////////////////////////////////

        function startGame() {
            if(gameStarted == false) {     
                var music = new Audio("Sounds/thinking-music.mp3");
                music.loop = true;
                music.play();
                drawCountdown();
                setInterval(() => { gameStarted = true; }, 3000);
                
            }
            
        }

        function setBackground() {
            var num = Math.floor(Math.random() * 4);  //0 - 4
            if(num == 0) {
                // var link = document.getElementsById("lnk"); //Fetch the link by its ID
                // link.setAttribute("body", ".bg-flat-mountains"); //Change its href attribute
                document.body.className = "animated-shape";
            }
            else if(num == 1) {
                document.body.className = "meteor";
                
            }
            else if(num == 2) {
                document.body.className = "circles";

                
            }
            else if(num == 3) {
                document.body.className = "waves";
                
            }
            else if(num == 4) {
                document.body.className = "lines";
                
            }
        }

        function checkRealtiveRebounds() {
            //toggle checkbox
            var checkBoxRealtive = document.getElementById("myCheckRelative");
            relativeAngleReboundToggle = checkBoxRealtive.checked;
        }

        function toggleRandomResize() {
            randResizeToggle = true;
        }

        function resizeCanvas() {

            
            if(resizeTick > 0 && canvasSizeIncrease == false) {
                ctx.canvas.width -= resizePerTick;
                ctx.canvas.height -= resizePerTick;
                //draw(); 
                resizeTick -= 1;
                setTimeout(resizeCanvas, 10);
            }
            else if (resizeTick < resizeAmount){
                canvasSizeIncrease = true;
                ctx.canvas.width += resizePerTick;
                ctx.canvas.height += resizePerTick;
                // draw();
                resizeTick += 1;
                if(resizeTick == resizeAmount) return;
                setTimeout(resizeCanvas, 10);
                
            }
            else {
                canvasSizeIncrease = false;
            }
            
        }


        document.addEventListener("keydown", keyDownHandler, false);
        document.addEventListener("keyup", keyUpHandler, false);
        document.addEventListener("mousemove", mouseMoveHandler, false);

        function keyDownHandler(e) {
            //Bottom player
            if(e.key == "Right" || e.key == "ArrowRight") {
                bottomPaddle.rightPress = true;
            }
            
            else if(e.key == "Left" || e.key == "ArrowLeft") {
                bottomPaddle.leftPress = true;
            }

            //Top player
            if(e.key == "a") {
                topPaddle.leftPress = true;
            }       
            else if(e.key == "d") {
                topPaddle.rightPress = true;
            }

            //Left player
            if(e.key == "o") {
                leftPaddle.upPress = true;
            }
            else if(e.key == "l") {
                leftPaddle.downPress = true;
            }

            //Right player
            if(e.key == "-" ) {
                rightPaddle.upPress = true;
            }
            else if(e.key == "+") {
                rightPaddle.downPress = true;
            }

            //Manual start game
            if(e.key == " " ) {
                startGame();
            }
        }

        function keyUpHandler(e) {
            //Bottom player
            if(e.key == "Right" || e.key == "ArrowRight") {
                bottomPaddle.rightPress = false;
            }
            else if(e.key == "Left" || e.key == "ArrowLeft") {
                bottomPaddle.leftPress = false;
            }

            //Top player
            if(e.key == "a") {
                topPaddle.leftPress = false;
            }       
            else if(e.key == "d") {
                topPaddle.rightPress = false;
            }

            //Left player
            if(e.key == "o") {
                leftPaddle.upPress = false;
            }
            else if(e.key == "l") {
                leftPaddle.downPress = false;
            }

            //Right player
            if(e.key == "-" ) {
                rightPaddle.upPress = false;
            }
            else if(e.key == "+") {
                rightPaddle.downPress = false;
            }

            // if(e.key == " " ) {
            //     randResizeToggle = false;
            // }
        }
        

        function mouseMoveHandler(e) {
            var relativeX = e.clientX - canvas.offsetLeft;
            var relativeY = e.clientY - canvas.offsetTop;
            if(relativeX > 0 && relativeX < canvas.width) {
                //document.getElementById("xPosMouse").innerHTML = relativeX;
                bottomPaddle.x = Math.round(Math.round(relativeX - bottomPaddle.width/2)/10)*10;
                topPaddle.x = Math.round(Math.round(relativeX - topPaddle.width/2)/10)*10;
                
                

            }
            if(relativeY > 0 && relativeY < canvas.height) {
                //document.getElementById("yPosMouse").innerHTML = relativeY;
                leftPaddle.y = Math.round(Math.round(relativeY - leftPaddle.width/2)/10)*10;
                rightPaddle.y = Math.round(Math.round(relativeY - rightPaddle.width/2)/10)*10;
            }
        }

        function getRandomArbitrary(min, max) {
            return Math.random() * (max - min) + min;
        }

        function checkWinner() {
            var size = borderWidth;
            ctx.fillStyle = "steelblue";
            var font = size + "px verdana";
            ctx.font = font;
            ctx.textAlign = "center";
            

            if(topPaddle.lives > 0 && leftPaddle.lives == 0 && rightPaddle.lives == 0 && bottomPaddle.lives == 0) {
                ctx.clearRect(0, 0, canvas.height, canvas.height);
                ctx.fillStyle = topPaddle.colour;
                ctx.fillText('Red Wins!', canvas.width/2, canvas.height/2);
                gameOver = true;
                gameStarted = false;
            }
            else if(leftPaddle.lives > 0 && topPaddle.lives == 0 && rightPaddle.lives == 0 && bottomPaddle.lives == 0) {
                ctx.clearRect(0, 0, canvas.height, canvas.height);
                ctx.fillStyle = leftPaddle.colour;
                ctx.fillText('Green Wins!', canvas.width/2, canvas.height/2);
                gameOver = true;
                gameStarted = false;


            }
            else if(rightPaddle.lives > 0 && leftPaddle.lives == 0 && topPaddle.lives == 0 && bottomPaddle.lives == 0) {
                ctx.clearRect(0, 0, canvas.height, canvas.height);
                ctx.fillStyle = rightPaddle.colour;
                ctx.fillText('Purple Wins!', canvas.width/2, canvas.height/2);
                gameOver = true;
                gameStarted = false;


            }
            else if(bottomPaddle.lives > 0 && leftPaddle.lives == 0 && rightPaddle.lives == 0 && topPaddle.lives == 0) {
                ctx.clearRect(0, 0, canvas.height, canvas.height);
                ctx.fillStyle = bottomPaddle.colour;
                ctx.fillText('Blue Wins!', canvas.width/2, canvas.height/2);
                gameOver = true;
                gameStarted = false;


            }
        }

        function drawCountdown() {
            var music = new Audio("Sounds/countdown.mp3");
            music.play();

            var size = borderWidth;
            var font = size + "px verdana";
            ctx.font = font;
            ctx.textAlign = "center";
            ctx.fillText('Ready!', canvas.width/2, canvas.height/2);

            setTimeout(() => {
                ctx.clearRect(0, 0, canvas.height, canvas.height);
                ctx.fillText('Set!', canvas.width/2, canvas.height/2);
            }, 1000)

            setTimeout(() => {
                ctx.clearRect(0, 0, canvas.height, canvas.height);
                ctx.fillText('GO!', canvas.width/2, canvas.height/2);
            }, 2000)

        }
        
        function drawBorder() {
            ctx.beginPath();
            ctx.rect(borderWidth, borderWidth, canvas.width - 2*borderWidth, canvas.height - 2*borderWidth);
            ctx.fillStyle = "#000000";
            ctx.stroke();
            ctx.closePath();
        }

        function drawBall(ball) {

            //Have ball start in a random direction
            if(ball.initialPos == true) {

                ball.dx = getRandomArbitrary(0, speedRatio) * (Math.round(Math.random()) * 2 - 1);          
                ball.dy = Math.sqrt(speedRatio*speedRatio - ball.dx*ball.dx) * (Math.round(Math.random()) * 2 - 1);
                ball.x = canvas.height/2;
                ball.y = canvas.height/2;
            }
            ball.initialPos = false;
            ctx.beginPath();
            ctx.arc(ball.x, ball.y, ballRadius, 0, Math.PI*2);
            ctx.fillStyle = ball.colour;
            ctx.fill();
            ctx.closePath();

            ctx.beginPath();
            ctx.arc(ball.x, ball.y, ballRadius, 0, Math.PI*2);
            ctx.stroke();
            ctx.closePath();

        }

        function drawPowerup(powerup) {
            if(powerup.active == false) {
                //Set coords
                powerup.x = getRandomArbitrary(2*borderWidth, canvas.height - 2*borderWidth);
                powerup.y = getRandomArbitrary(2*borderWidth, canvas.height - 2*borderWidth);

                powerup.active = true;
                
            }
            
            var randomColor;
            if(powerup.colourCounter == 10) {
                randomColor = Math.floor(Math.random()*16777215).toString(16);
                powerup.colour = "#" + randomColor;
                powerup.colourCounter = 0;
            }
            ctx.fillStyle = powerup.colour;
            ctx.fillRect(powerup.x, powerup.y, powerup.size, powerup.size);   
            powerup.colourCounter++;      

            ctx.beginPath();
            ctx.rect(powerup.x, powerup.y, powerup.size, powerup.size);
            ctx.fillStyle = "#000000";
            ctx.stroke();
            ctx.closePath();

            var size = powerup.size + 4;
            var font = size + "px verdana";
            ctx.font = font;
            ctx.textAlign = "center";
            ctx.fillText('?', powerup.x + powerup.size/2, powerup.y + powerup.size - 2);
            
        }

        function givePowerup(ball) {
            //Get the owner
            var owner;
            //alert(ball.owner);
            if(ball.owner == 'top') {
                deployPowerup(topPaddle);
            }
            else if (ball.owner == 'left') {
                deployPowerup(leftPaddle);
            }
            else if (ball.owner == 'right') {
                deployPowerup(rightPaddle);
            }
            else if (ball.owner == 'bottom') {
                deployPowerup(bottomPaddle);
            }
            else return;

            
            
        }

        function deployPowerup(paddle) {
            //Pick a random powerup
            var rand = Math.floor(Math.random() * 4);  //0 - 4

            if(rand == 0) { //Make paddle bigger
                if(paddle.width < 2*defaultPaddleWidth) paddle.width *= 2;              
            }
            else if(rand == 1) {    //Make paddle smaller
                if(paddle.width > defaultPaddleWidth/2) paddle.width /= 2;
                
            }
            else if(rand == 2) {    //Give player an extra life
                if(paddle.lives < 3 && paddle.lives > 0) paddle.lives++;
            }
            else if(rand == 3) {    //Make ball faster
                if(ball1.ballSpeed < 2*defaultBallSpeed) {
                    ball1.ballSpeed *= 2;
                    speedRatio = Math.sqrt((ball1.ballSpeed*ball1.ballSpeed) + (ball1.ballSpeed*ball1.ballSpeed));
                }
                
            }
            else if(rand == 4) {    //

            }
        }

        function drawLives() {
            var height = borderWidth/3;
            var gap = height/2;
            var lives = 0;

            // ctx.beginPath();
            // ctx.moveTo(canvas.width/2, 0);
            // ctx.lineTo(canvas.width/2, canvas.height);
            // ctx.stroke();
            // ctx.closePath();

            // ctx.beginPath();
            // ctx.moveTo(0, canvas.height/2);
            // ctx.lineTo(canvas.width, canvas.height/2);
            // ctx.stroke();
            // ctx.closePath();

            // lives = topPaddle.lives;
            // for(var i = 0; i <topPaddle.lives; i++) {
            //     ctx.beginPath();
            //     ctx.arc(canvas.width/2 + i*(gap+height), height, height/2, 0, Math.PI*2);
            //     ctx.fillStyle = topPaddle.colour;
            //     ctx.fill();
            //     ctx.stroke();
            //     ctx.closePath();
            // }

            //Top
            if(topPaddle.lives > 2) {
                ctx.beginPath();
                ctx.arc(canvas.width/2 - 2*height, height, height/2, 0, Math.PI*2);
                ctx.fillStyle = topPaddle.colour;
                ctx.fill();
                ctx.stroke();
                ctx.closePath();

                ctx.beginPath();
                ctx.arc(canvas.width/2, height, height/2, 0, Math.PI*2);
                ctx.fillStyle = topPaddle.colour;
                ctx.fill();
                ctx.stroke();
                ctx.closePath();

                ctx.beginPath();
                ctx.arc(canvas.width/2 + 2*height, height, height/2, 0, Math.PI*2);
                ctx.fillStyle = topPaddle.colour;
                ctx.fill();
                ctx.stroke();
                ctx.closePath();
            }
            else if(topPaddle.lives > 1) {
                ctx.beginPath();
                ctx.arc(canvas.width/2 - height, height, height/2, 0, Math.PI*2);
                ctx.fillStyle = topPaddle.colour;
                ctx.fill();
                ctx.stroke();
                ctx.closePath();

                ctx.beginPath();
                ctx.arc(canvas.width/2 + height, height, height/2, 0, Math.PI*2);
                ctx.fillStyle = topPaddle.colour;
                ctx.fill();
                ctx.stroke();
                ctx.closePath();
            }
            else if(topPaddle.lives > 0) {
                ctx.beginPath();
                ctx.arc(canvas.width/2, height, height/2, 0, Math.PI*2);
                ctx.fillStyle = topPaddle.colour;
                ctx.fill();
                ctx.stroke();
                ctx.closePath();
            }

            //Left
            if (leftPaddle.lives > 2) {
                ctx.beginPath();
                ctx.arc(height, canvas.height/2 - 2*height, height/2, 0, Math.PI*2);
                ctx.fillStyle = leftPaddle.colour;
                ctx.fill();
                ctx.stroke();
                ctx.closePath();

                ctx.beginPath();
                ctx.arc(height, canvas.height/2, height/2, 0, Math.PI*2);
                ctx.fillStyle = leftPaddle.colour;
                ctx.fill();
                ctx.stroke();
                ctx.closePath();

                ctx.beginPath();
                ctx.arc(height, canvas.height/2 + 2*height, height/2, 0, Math.PI*2);
                ctx.fillStyle = leftPaddle.colour;
                ctx.fill();
                ctx.stroke();
                ctx.closePath();
            }
            else if(leftPaddle.lives > 1) {
                ctx.beginPath();
                ctx.arc(height, canvas.height/2 - height, height/2, 0, Math.PI*2);
                ctx.fillStyle = leftPaddle.colour;
                ctx.fill();
                ctx.stroke();
                ctx.closePath();

                ctx.beginPath();
                ctx.arc(height, canvas.height/2 + height, height/2, 0, Math.PI*2);
                ctx.fillStyle = leftPaddle.colour;
                ctx.fill();
                ctx.stroke();
                ctx.closePath();
            }
            else if(leftPaddle.lives > 0) {
                ctx.beginPath();
                ctx.arc(height, canvas.height/2, height/2, 0, Math.PI*2);
                ctx.fillStyle = leftPaddle.colour;
                ctx.fill();
                ctx.stroke();
                ctx.closePath();
            }

            //Right
            if (rightPaddle.lives > 2) {
                ctx.beginPath();
                ctx.arc(canvas.width - height, canvas.height/2 - 2*height, height/2, 0, Math.PI*2);
                ctx.fillStyle = rightPaddle.colour;
                ctx.fill();
                ctx.stroke();
                ctx.closePath();

                ctx.beginPath();
                ctx.arc(canvas.width - height, canvas.height/2, height/2, 0, Math.PI*2);
                ctx.fillStyle = rightPaddle.colour;
                ctx.fill();
                ctx.stroke();
                ctx.closePath();

                ctx.beginPath();
                ctx.arc(canvas.width - height, canvas.height/2 + 2*height, height/2, 0, Math.PI*2);
                ctx.fillStyle = rightPaddle.colour;
                ctx.fill();
                ctx.stroke();
                ctx.closePath();
            }
            else if(rightPaddle.lives > 1) {
                ctx.beginPath();
                ctx.arc(canvas.width - height, canvas.height/2 - height, height/2, 0, Math.PI*2);
                ctx.fillStyle = rightPaddle.colour;
                ctx.fill();
                ctx.stroke();
                ctx.closePath();

                ctx.beginPath();
                ctx.arc(canvas.width - height, canvas.height/2 + height, height/2, 0, Math.PI*2);
                ctx.fillStyle = rightPaddle.colour;
                ctx.fill();
                ctx.stroke();
                ctx.closePath();
            }
            else if(rightPaddle.lives > 0) {
                ctx.beginPath();
                ctx.arc(canvas.width - height, canvas.height/2, height/2, 0, Math.PI*2);
                ctx.fillStyle = rightPaddle.colour;
                ctx.fill();
                ctx.stroke();
                ctx.closePath();
            }

            //Bottom
            if (bottomPaddle.lives > 2) {
                ctx.beginPath();
                ctx.arc(canvas.width/2 - 2*height, canvas.height - height, height/2, 0, Math.PI*2);
                ctx.fillStyle = bottomPaddle.colour;
                ctx.fill();
                ctx.stroke();
                ctx.closePath();

                ctx.beginPath();
                ctx.arc(canvas.width/2, canvas.height - height, height/2, 0, Math.PI*2);
                ctx.fillStyle = bottomPaddle.colour;
                ctx.fill();
                ctx.stroke();
                ctx.closePath();

                ctx.beginPath();
                ctx.arc(canvas.width/2 + 2*height, canvas.height - height, height/2, 0, Math.PI*2);
                ctx.fillStyle = bottomPaddle.colour;
                ctx.fill();
                ctx.stroke();
                ctx.closePath();
            }
            else if(bottomPaddle.lives > 1) {
                ctx.beginPath();
                ctx.arc(canvas.width/2 - height, canvas.height - height, height/2, 0, Math.PI*2);
                ctx.fillStyle = bottomPaddle.colour;
                ctx.fill();
                ctx.stroke();
                ctx.closePath();

                ctx.beginPath();
                ctx.arc(canvas.width/2 + height, canvas.height - height, height/2, 0, Math.PI*2);
                ctx.fillStyle = bottomPaddle.colour;
                ctx.fill();
                ctx.stroke();
                ctx.closePath();
            }
            else if(bottomPaddle.lives > 0) {
                ctx.beginPath();
                ctx.arc(canvas.width/2, canvas.height - height, height/2, 0, Math.PI*2);
                ctx.fillStyle = bottomPaddle.colour;
                ctx.fill();
                ctx.stroke();
                ctx.closePath();
            }
        }



        function bounce(ball) {
            var mySound = new Audio("Sounds/pop1.mp3");
            mySound.play();
            if( ball.colour ==  "#000000") {
                ball.colour = "#FFFFFF";
            }
            else{
                ball.colour = "#000000";
            }
        }

        function drawPaddle() {
            //bottom
            if(bottomPaddle.lives > 0) {
                ctx.beginPath();
                ctx.rect(bottomPaddle.x, canvas.height-borderWidth-paddleHeight, bottomPaddle.width, paddleHeight);
                ctx.fillStyle = bottomPaddle.colour;
                ctx.fill();
                ctx.closePath();

                ctx.beginPath();
                ctx.rect(bottomPaddle.x, canvas.height-borderWidth-paddleHeight, bottomPaddle.width, paddleHeight);
                ctx.stroke();
                ctx.closePath();
            }
            else {
                ctx.beginPath();
                ctx.rect(borderWidth + paddleHeight, canvas.height-borderWidth-paddleHeight, canvas.width - 2*borderWidth - 2*paddleHeight, paddleHeight);
                ctx.fillStyle = bottomPaddle.colour;
                ctx.fill();
                ctx.closePath();

                ctx.beginPath();
                ctx.rect(borderWidth + paddleHeight, canvas.height-borderWidth-paddleHeight, canvas.width - 2*borderWidth - 2*paddleHeight, paddleHeight);
                ctx.stroke();
                ctx.closePath();
            }
            

            //top
            if(topPaddle.lives > 0) {
                ctx.beginPath();
                ctx.rect(topPaddle.x, borderWidth, topPaddle.width, paddleHeight);
                ctx.fillStyle = topPaddle.colour;
                ctx.fill();
                ctx.closePath();

                ctx.beginPath();
                ctx.rect(topPaddle.x, borderWidth, topPaddle.width, paddleHeight);
                ctx.stroke();
                ctx.closePath();
            }
            else {
                ctx.beginPath();
                ctx.rect(borderWidth + paddleHeight, borderWidth, canvas.width - 2*borderWidth - 2*paddleHeight, paddleHeight);
                ctx.fillStyle = topPaddle.colour;
                ctx.fill();
                ctx.closePath();

                ctx.beginPath();
                ctx.rect(borderWidth + paddleHeight, borderWidth, canvas.width - 2*borderWidth - 2*paddleHeight, paddleHeight);
                ctx.stroke();
                ctx.closePath();
            }
            

            //left
            if(leftPaddle.lives > 0) {
                ctx.beginPath();
                ctx.rect(borderWidth, leftPaddle.y, paddleHeight, leftPaddle.width);
                ctx.fillStyle = leftPaddle.colour;
                ctx.fill();
                ctx.closePath();

                ctx.beginPath();
                ctx.rect(borderWidth, leftPaddle.y, paddleHeight, leftPaddle.width);
                ctx.stroke();
                ctx.closePath();
            }
            else {
                ctx.beginPath();
                ctx.rect(borderWidth, borderWidth + paddleHeight, paddleHeight, canvas.height - 2*borderWidth - 2*paddleHeight);
                ctx.fillStyle = leftPaddle.colour;
                ctx.fill();
                ctx.closePath();

                ctx.beginPath();
                ctx.rect(borderWidth, borderWidth + paddleHeight, paddleHeight, canvas.height - 2*borderWidth - 2*paddleHeight);
                ctx.stroke();
                ctx.closePath();
            }
            
            

            //right
            if(rightPaddle.lives > 0) {
                ctx.beginPath();
                ctx.rect(canvas.width - paddleHeight - borderWidth, rightPaddle.y, paddleHeight, rightPaddle.width);
                ctx.fillStyle = rightPaddle.colour;
                ctx.fill();
                ctx.closePath();

                ctx.beginPath();
                ctx.rect(canvas.width - paddleHeight - borderWidth, rightPaddle.y, paddleHeight, rightPaddle.width);
                ctx.stroke();
                ctx.closePath();
            }
            else {
                ctx.beginPath();
                ctx.rect(canvas.width - paddleHeight - borderWidth, borderWidth + paddleHeight, paddleHeight, canvas.height - 2*borderWidth - 2*paddleHeight);
                ctx.fillStyle = rightPaddle.colour;
                ctx.fill();
                ctx.closePath();

                ctx.beginPath();
                ctx.rect(canvas.width - paddleHeight - borderWidth, borderWidth + paddleHeight, paddleHeight, canvas.height - 2*borderWidth - 2*paddleHeight);
                ctx.stroke();
                ctx.closePath();
            }
        }
        

        function draw() {
            
            if(gameOver == false) {
                if(gameStarted == true) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                if(randResizeToggle == true) {
                
                resizeCanvas();
                randResizeToggle = false;
                }

                //Show positions
                //document.getElementById("ballDx").innerHTML = Math.round(ball1.dx * 100) / 100;
                //document.getElementById("ballDy").innerHTML = Math.round(ball1.dy * 100) / 100;

                
                drawLives();
                drawPowerup(powerup1);
                drawPowerup(powerup2);

                powerupCollision(ball1, powerup1);
                powerupCollision(ball1, powerup2);

                


                drawBorder();
                drawBall(ball1);
                //drawBall(ball2);
                drawPaddle();

                // Paddle collision checks           
                //Bottom check
                bottomCollision(ball1);
                //bottomCollision(ball2);

                //Left check
                leftCollision(ball1);
                //leftCollision(ball2);

                //Top check
                topCollision(ball1);
                //topCollision(ball2);

                //Right  check
                rightCollision(ball1);
                //rightCollision(ball2);

                //Move paddles
                //Bottom player
                if(bottomPaddle.rightPress && bottomPaddle.x < canvas.width-bottomPaddle.width-borderWidth-paddleHeight) {
                    bottomPaddle.x += paddleSpeed;
                }
                else if(bottomPaddle.leftPress && bottomPaddle.x > borderWidth + paddleHeight) {
                    bottomPaddle.x -= paddleSpeed;
                    
                }

                //Top player
                if(topPaddle.rightPress && topPaddle.x < canvas.width-topPaddle.width-borderWidth-paddleHeight) {
                    //alert('here');
                    topPaddle.x += paddleSpeed;
                }
                else if(topPaddle.leftPress && topPaddle.x > borderWidth + paddleHeight) {               
                    topPaddle.x -= paddleSpeed;
                }

                //Left player
                if(leftPaddle.upPress && leftPaddle.y > borderWidth + paddleHeight) {  
                    leftPaddle.y -= paddleSpeed;
                }
                else if(leftPaddle.downPress && leftPaddle.y < canvas.height-leftPaddle.width-borderWidth-paddleHeight) {
                    leftPaddle.y += paddleSpeed;
                }

                //Right player
                if(rightPaddle.upPress && rightPaddle.y > borderWidth + paddleHeight) {
                    rightPaddle.y -= paddleSpeed;
                }
                else if(rightPaddle.downPress && rightPaddle.y < canvas.height-rightPaddle.width-borderWidth-paddleHeight) {
                    rightPaddle.y += paddleSpeed;
                }

                //Move ball1
                ball1.x += ball1.dx;
                ball1.y += ball1.dy;

                //Move ball2
                ball2.x += ball1.dx;
                ball2.y += ball2.dy;

                checkWinner();
                }
                
                

                }    
            requestAnimationFrame(draw);     
        }

        draw();


        /////////////////////////////////////////////////////// Collision Functions //////////////////////////////////////////////////////////////////

        function powerupCollision(ball, powerup) {
            //alert('here');
            
            if(ball.x + ball.dx > powerup.x - ballRadius
            && ball.x + ball.dx < powerup.x + powerup.size + ballRadius
            && ball.y + ball.dy > powerup.y - ballRadius
            && ball.y + ball.dy < powerup.y + powerup.size + ballRadius) {
                var player = ball.owner;
                //document.getElementById("status").innerHTML = "Powerup Owner: " + player;
                var mySound = new Audio("Sounds/collect.mp3");
                mySound.play();
                powerup.active = false;
                givePowerup(ball);
                drawPowerup(powerup);
                ball.owner = 'none';
            }
        }


        function bottomCollision(ball) {
            if(ball.y + ball.dy > canvas.height-borderWidth-ballRadius-paddleHeight) { 
                if(bottomPaddle.lives == 0) {
                    ball.dy = -ball.dy;
                    //document.getElementById("status").innerHTML = "Bottom Paddle: Wall";
                    bounce(ball); 
                }

                //Check if ball has collided with paddle
                if(ball.x + ball.dx > bottomPaddle.x - ballRadius
                && ball.x + ball.dx < bottomPaddle.x + bottomPaddle.width + ballRadius
                && ball.y + ball.dy < canvas.height - borderWidth + ballRadius)
                {
                    ball.owner = 'bottom';
                    //Check if it rebounds on top
                    if(ball.x + ball.dx > bottomPaddle.x - (ballRadius/2) 
                        && ball.x + ball.dx < bottomPaddle.x + bottomPaddle.width + (ballRadius/2) 
                        && ball.y + ball.dy < canvas.height - borderWidth - paddleHeight) {
                        //Ball direction should only change once
                        if(Math.sign(ball.dy) == 1)
                        {
                            if(relativeAngleReboundToggle == true) {
                                if(ball.x < bottomPaddle.x + bottomPaddle.width/2) {    //Left side of paddle
                                    var angleMultiplier = (ball.x - (bottomPaddle.x - ballRadius/2))/(bottomPaddle.width/2 + ballRadius/2);
                                    var angle = angleMultiplier * (Math.PI/2);
                                    //document.getElementById("status").innerHTML = angleMultiplier;
                                    ball.dy = -(speedRatio * Math.sin(angle));
                                    var sign = Math.sign(ball.dx);
                                    if(sign == 0) sign = -1; 
                                    ball.dx = sign * (speedRatio * Math.cos(angle));
                                    bounce(ball);
                                }
                                else if (ball.x > bottomPaddle.x + bottomPaddle.width/2) {  //Right side of paddle
                                    var angleMultiplier = 1-(ball.x - (bottomPaddle.x + bottomPaddle.width/2))/(bottomPaddle.width/2 + ballRadius/2);
                                    var angle = angleMultiplier * (Math.PI/2);
                                    //document.getElementById("status").innerHTML = angleMultiplier;
                                    ball.dy = Math.round(-(speedRatio * Math.sin(angle)));
                                    var sign = Math.sign(ball.dx);
                                    if(sign == 0) sign = 1;
                                    ball.dx = Math.round(sign * (speedRatio * Math.cos(angle)));
                                    bounce(ball);
                                }
                                else {  //Unlikely occurance of it being perfectly in the middle
                                    ball.dy = -speedRatio
                                    ball.dx = 0;
                                    bounce(ball);
                                }
                            }
                            else {
                                ball.dy = -ball.dy;
                                //document.getElementById("status").innerHTML = "Bottom Paddle: Top";
                                bounce(ball);
                            }
                            
                        }
                    }
                    else{
                        //Left side
                        if(ball.x + ball.dx > bottomPaddle.x - ballRadius && ball.x + ball.dx < bottomPaddle.x) {
                            //document.getElementById("status").innerHTML = "Bottom Paddle: Left";
                            if(Math.sign(ball.dx) == 1) {
                                ball.dx = -ball.dx;
                                bounce(ball);
                            }                            
                        }
                        //Right side
                        else if(ball.x + ball.dx < bottomPaddle.x + bottomPaddle.width + ballRadius && ball.x + ball.dx > bottomPaddle.x + bottomPaddle.width) {
                            //document.getElementById("status").innerHTML = "Bottom Paddle: Right";
                            if(Math.sign(ball.dx) == -1) {
                                ball.dx = -ball.dx;
                                bounce(ball);
                            } 
                        }
                    }
                    
                    
                }
                //Otherwise player missed
                else{
                    if(ball.y > canvas.height) {
                        //Take off a life
                        bottomPaddle.lives--;
                        if(bottomPaddle.lives == 0) {
                            var mySound = new Audio("Sounds/dead.mp3");
                            mySound.play();
                        }
                        else {
                            var mySound = new Audio("Sounds/looseLife.mp3");
                            mySound.play();
                        }

                        //Reset ball
                        ball.initialPos = true;

                        ball.x = canvas.width/2;
                        ball.y = canvas.height*4/5;
                        ball.dx = 0;
                        ball.dy = -speedRatio;
                    //bottomPaddleX = (canvas.width-paddleWidth)/2;
                    }
                }
            }
        }        

        function rightCollision(ball) {
            if(ball.x + ball.dx > canvas.height-borderWidth-ballRadius-paddleHeight) { 
                if(rightPaddle.lives == 0) {
                    ball.dx = -ball.dx;
                    //document.getElementById("status").innerHTML = "Right Paddle: Wall";
                    bounce(ball);
                }

                //Check if ball has collided with paddle
                if(ball.y + ball.dy > rightPaddle.y - ballRadius
                && ball.y + ball.dy < rightPaddle.y + rightPaddle.width + ballRadius
                && ball.x + ball.dx < canvas.height - borderWidth + ballRadius)
                {
                    ball.owner = 'right';
                    //Check if it rebounds left side
                    if(ball.y + ball.dy > rightPaddle.y - (ballRadius/2) 
                        && ball.y + ball.dy < rightPaddle.y + rightPaddle.width + (ballRadius/2) 
                        && ball.x + ball.dx < canvas.height - borderWidth - paddleHeight) {
                        //Ball direction should only change once
                        if(Math.sign(ball.dx) == 1)
                        {
                            if(relativeAngleReboundToggle == true) {
                                if(ball.y < rightPaddle.y + rightPaddle.width/2) {     //Top half of paddle
                                    var angleMultiplier = (ball.y - (rightPaddle.y - ballRadius/2)) / (rightPaddle.width/2 + ballRadius/2);
                                    var angle = angleMultiplier * (Math.PI/2);
                                    //document.getElementById("status").innerHTML = angleMultiplier;
                                    ball.dx = -(speedRatio * Math.sin(angle));
                                    var sign = Math.sign(ball.dy);
                                    if(sign == 0) sign = -1;
                                    ball.dy = sign * (speedRatio * Math.cos(angle));
                                    bounce(ball);
                                }
                                else if(ball.y > rightPaddle.y + rightPaddle.width/2) {   //Bottom half of paddle
                                    var angleMultiplier = 1-((ball.y - (rightPaddle.y + rightPaddle.width/2)) / (rightPaddle.width/2 + ballRadius/2));
                                    var angle = angleMultiplier * (Math.PI/2);
                                    //document.getElementById("status").innerHTML = angleMultiplier;
                                    ball.dx = -(speedRatio * Math.sin(angle));
                                    var sign = Math.sign(ball.dy);
                                    if(sign == 0) sign = 1;
                                    ball.dy = sign * (speedRatio * Math.cos(angle));
                                    bounce(ball);
                                }
                                else {
                                    ball.dy = 0;
                                    ball.dx = -speedRatio;
                                    bounce(ball);
                                }
                            }
                            else {
                                ball.dx = -ball.dx;
                                //document.getElementById("status").innerHTML = "Right Paddle: Side";
                                bounce(ball);
                            }
                            
                        }
                    }
                    else{
                        //Top side
                        if(ball.y + ball.dy > rightPaddle.y - ballRadius && ball.y + ball.dy < rightPaddle.y) {
                            //document.getElementById("status").innerHTML = "Right Paddle: Top";
                            if(Math.sign(ball.dy) == 1) {
                                ball.dy = -ball.dy;
                                bounce(ball);
                            }                            
                        }
                        //Bottom side
                        else if(ball.y + ball.dy < rightPaddle.y + rightPaddle.width + ballRadius && ball.y + ball.dy > rightPaddle.y + rightPaddle.width) {
                            //document.getElementById("status").innerHTML = "Right Paddle: Bottom";
                            if(Math.sign(ball.dy) == -1) {
                                ball.dy = -ball.dy;
                                bounce(ball);
                            } 
                        }
                    }
                    
                    
                }
                //Otherwise player missed
                else{
                    if(ball.x > canvas.height) {
                        //Take off a life
                        rightPaddle.lives--;
                        if(rightPaddle.lives == 0) {
                            var mySound = new Audio("Sounds/dead.mp3");
                            mySound.play();
                        }
                        else {
                            var mySound = new Audio("Sounds/looseLife.mp3");
                            mySound.play();
                        }

                        //Reset ball
                        ball.initialPos = true;

                        ball.x = canvas.width/2;
                        ball.y = canvas.height*4/5;
                        ball.dx = 0;
                        ball.dy = -speedRatio;
                    //bottomPaddleX = (canvas.width-paddleWidth)/2;
                    }
                }
            }
        } 
        
        function leftCollision(ball) {
            if(ball.x + ball.dx < borderWidth + paddleHeight + ballRadius) {    
                if(leftPaddle.lives == 0) {
                    ball.dx = -ball.dx;
                    bounce(ball);
                    //document.getElementById("status").innerHTML = "Left Paddle: Wall";
                }           

                //Check if ball has collided with paddle
                if(ball.y + ball.dy > leftPaddle.y - ballRadius
                && ball.y + ball.dy < leftPaddle.y + leftPaddle.width + ballRadius
                && ball.x + ball.dx > borderWidth - ballRadius) 
                { 
                    ball.owner = 'left';
                    //Check if it rebounds on right side
                    if(ball.y + ball.dy > leftPaddle.y - (ballRadius/2)
                    && ball.y + ball.dy < leftPaddle.y + leftPaddle.width + (ballRadius/2)
                    && ball.x + ball.dx > borderWidth + paddleHeight)
                    {
                        if(Math.sign(ball.dx) == -1)
                        {
                            if(relativeAngleReboundToggle == true) {
                                if(ball.y < leftPaddle.y + leftPaddle.width/2) {      //Top half of paddle
                                    var angleMultiplier = (ball.y - (leftPaddle.y - ballRadius/2)) / (leftPaddle.width/2 + ballRadius/2);
                                    var angle = angleMultiplier * (Math.PI/2);
                                    //document.getElementById("status").innerHTML = angleMultiplier;
                                    ball.dx = (speedRatio * Math.sin(angle));
                                    var sign = Math.sign(ball.dy);
                                    if(sign == 0) sign = -1;
                                    ball.dy = sign * (speedRatio * Math.cos(angle));
                                    bounce(ball);
                                }
                                else if(ball.y > leftPaddle.y + leftPaddle.width/2) {   //Bottom half of paddle
                                    var angleMultiplier = 1-((ball.y - (leftPaddle.y + leftPaddle.width/2)) / (leftPaddle.width/2 + ballRadius/2));
                                    var angle = angleMultiplier * (Math.PI/2);
                                    //document.getElementById("status").innerHTML = angleMultiplier;
                                    ball.dx = (speedRatio * Math.sin(angle));
                                    var sign = Math.sign(ball.dy);
                                    if(sign == 0) sign = 1;
                                    ball.dy = sign * (speedRatio * Math.cos(angle));
                                    bounce(ball);
                                }
                                else {
                                    ball.dy = 0;
                                    ball.dx = -speedRatio;
                                    bounce(ball);
                                }
                            }
                            else {
                                ball.dx = -ball.dx;
                                bounce(ball);
                                //document.getElementById("status").innerHTML = "Left Paddle: Side";
                            }
                            
                        }
                    }
                    else {
                        //Top
                        if(ball.y + ball.dy > leftPaddle.y - ballRadius && ball.y + ball.dy < leftPaddle.y) {
                            if(Math.sign(ball.dy) == 1)
                            {
                                ball.dy = -ball.dy;
                                bounce(ball);
                                //document.getElementById("status").innerHTML = "Left Paddle: Top";
                            }                            
                        }
                        //Bottom
                        else if(ball.y + ball.dy < leftPaddle.y + leftPaddle.width + ballRadius && ball.y + ball.dy > leftPaddle.y + leftPaddle.width) {
                            if(Math.sign(ball.dy) == -1)
                            {
                                ball.dy = -ball.dy;
                                bounce(ball);
                                //document.getElementById("status").innerHTML = "Left Paddle: Bottom";
                            }
                        }

                    }

                }
                // Otherwise player missed
                else {
                    if(ball.x < 0) {
                        //Take off a life
                        leftPaddle.lives--;
                        if(leftPaddle.lives == 0) {
                            var mySound = new Audio("Sounds/dead.mp3");
                            mySound.play();
                        }
                        else {
                            var mySound = new Audio("Sounds/looseLife.mp3");
                            mySound.play();
                        }

                        //Reset ball
                        ball.initialPos = true;

                        ball.x = canvas.width/2;
                        ball.y = canvas.height*4/5;
                        ball.dx = 0;
                        ball.dy = -speedRatio;
                    //bottomPaddleX = (canvas.width-paddleWidth)/2;
                    }                   
                }               
            }
        }

        function topCollision(ball) {
            if(ball.y + ball.dy < borderWidth + paddleHeight + ballRadius) {
                if(topPaddle.lives == 0) {
                    ball.dy = -ball.dy;
                    bounce(ball);
                    //document.getElementById("status").innerHTML = "Top Paddle: Wall";
                }
                
                //Check if ball has collided with paddle
                if(ball.x + ball.dx > topPaddle.x - ballRadius
                && ball.x + ball.dx < topPaddle.x + topPaddle.width + ballRadius
                && ball.y + ball.dy > borderWidth - ballRadius) 
                { 
                    //alert(topPaddle.x);
                    ball.owner = 'top';
                    //Check if it rebounds on bottom
                    if(ball.x + ball.dx > topPaddle.x - (ballRadius/2)
                    && ball.x + ball.dx < topPaddle.x + topPaddle.width + (ballRadius/2)
                    && ball.y + ball.dy > borderWidth + paddleHeight)
                    {
                        
                        if(Math.sign(ball.dy) == -1)
                        {
                            if(relativeAngleReboundToggle == true) {
                                if(ball.x < topPaddle.x + topPaddle.width/2) {    //Left side of paddle
                                    var angleMultiplier = (ball.x - (topPaddle.x - ballRadius/2))/(topPaddle.width/2 + ballRadius/2);
                                    var angle = angleMultiplier * (Math.PI/2);
                                    //document.getElementById("status").innerHTML = angleMultiplier;
                                    ball.dy = (speedRatio * Math.sin(angle));
                                    var sign = Math.sign(ball.dx);
                                    if(sign == 0) sign = -1; 
                                    ball.dx = sign * (speedRatio * Math.cos(angle));
                                    bounce(ball);
                                }
                                else if (ball.x > topPaddle.x + topPaddle.width/2) {  //Right side of paddle
                                    var angleMultiplier = 1-(ball.x - (topPaddle.x + topPaddle.width/2))/(topPaddle.width/2 + ballRadius/2);
                                    var angle = angleMultiplier * (Math.PI/2);
                                    //document.getElementById("status").innerHTML = angleMultiplier;
                                    ball.dy = (speedRatio * Math.sin(angle));
                                    var sign = Math.sign(ball.dx);
                                    if(sign == 0) sign = 1;
                                    ball.dx = sign * (speedRatio * Math.cos(angle));
                                    bounce(ball);
                                }
                                else {  //Unlikely occurance of it being perfectly in the middle
                                    ball.dy = -speedRatio
                                    ball.dx = 0;
                                    bounce(ball);
                                }
                            }
                            else {
                                ball.dy = -ball.dy;
                                bounce(ball);
                                //document.getElementById("status").innerHTML = "Top Paddle: Bottom";
                            }
                            
                        }
                    }
                    else {
                        //Top
                        if(ball.x + ball.dx > topPaddle.x - ballRadius && ball.x + ball.dx < topPaddle.x) {
                            if(Math.sign(ball.dx) == 1)
                            {
                                ball.dx = -ball.dx;
                                bounce(ball);
                                //document.getElementById("status").innerHTML = "Top Paddle: Left";
                            }                            
                        }
                        //Bottom
                        else if(ball.x + ball.dx < topPaddle.x + topPaddle.width + ballRadius && ball.x + ball.dx > topPaddle.x + topPaddle.width) {
                            if(Math.sign(ball.dx) == -1)
                            {
                                ball.dx = -ball.dx;
                                bounce(ball);
                                //document.getElementById("status").innerHTML = "Top Paddle: Right";
                            }
                        }

                    }

                }
                // Otherwise player missed
                else {
                    if(ball.y < 0) {
                        //Take off a life
                        topPaddle.lives--;
                        if(topPaddle.lives == 0) {
                            var mySound = new Audio("Sounds/dead.mp3");
                            mySound.play();
                        }
                        else {
                            var mySound = new Audio("Sounds/looseLife.mp3");
                            mySound.play();
                        }

                        //Reset ball
                        ball.initialPos = true;

                        ball.x = canvas.width/2;
                        ball.y = canvas.height*4/5;
                        ball.dx = 0;
                        ball.dy = -speedRatio;
                    //bottomPaddleX = (canvas.width-paddleWidth)/2;
                    }                   
                }               
            }
        }
    </script>

</body>
</html>
